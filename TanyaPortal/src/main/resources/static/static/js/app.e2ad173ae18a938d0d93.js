webpackJsonp([2],{IcnI:function(e,t,n){"use strict";var r=n("mvHQ"),o=n.n(r),a=n("7+uW"),s=n("R4Sj");a.default.use(s.a),t.a=new s.a.Store({state:{token:"",user:{name:"",username:"",role:""},menu:[]},mutations:{initMenu:function(e,t){e.menu=t,console.log("获取权限树： "+t)},initUserInfo:function(e,t){e.user.name=t.name,e.user.role=t.roleId,console.log("获取用户基本信息: "+o()(t))},login:function(e,t){e.token=t.token,e.user.username=t.name,console.log("登录存储token: "+e.token)},logout:function(e){e.menu=[],e.token="",e.user.username="",e.user.role="",console.log("等出清除token: "+e.token)}}})},K31e:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("M9A7"),o={data:function(){return{rules:{account:[{required:!0,message:"请输入用户名",trigger:"blur"}],checkPass:[{required:!0,message:"请输入密码",trigger:"blur"}]},checked:!0,loginForm:{username:"superAdmin",password:""}}},methods:{submitClick:function(){Object(r.a)(this,{name:this.loginForm.username,pw:this.loginForm.password})}}},a={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-form",{staticClass:"login-container",attrs:{rules:e.rules,"label-position":"left","label-width":"0px"}},[n("h3",{staticClass:"login_title"},[e._v("系统登录")]),e._v(" "),n("el-form-item",{attrs:{prop:"account"}},[n("el-input",{attrs:{type:"text","auto-complete":"off",placeholder:"账号"},model:{value:e.loginForm.username,callback:function(t){e.$set(e.loginForm,"username",t)},expression:"loginForm.username"}})],1),e._v(" "),n("el-form-item",{attrs:{prop:"checkPass"}},[n("el-input",{attrs:{type:"password","auto-complete":"off",placeholder:"密码"},model:{value:e.loginForm.password,callback:function(t){e.$set(e.loginForm,"password",t)},expression:"loginForm.password"}})],1),e._v(" "),n("el-checkbox",{staticClass:"login_remember",attrs:{"label-position":"left"},model:{value:e.checked,callback:function(t){e.checked=t},expression:"checked"}},[e._v("记住密码")]),e._v(" "),n("el-form-item",{staticStyle:{width:"100%"}},[n("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},nativeOn:{click:function(t){return t.preventDefault(),e.submitClick(t)}}},[e._v("登录")])],1)],1)},staticRenderFns:[]};var s=n("VU/8")(o,a,!1,function(e){n("jyaM")},null,null);t.default=s.exports},M9A7:function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o});var r=function(e,t){e.getRequest("/login",{name:t.name,pw:t.pw}).then(function(t){if(t&&200===t.status){var n=t.data;e.$store.commit("login",n.data);var r=e.$route.query.redirect;console.log(r),e.$router.replace({path:"/"===r||void 0===r?"/home":r})}})},o=function(e){e.getRequest("/logoff").then(function(t){t&&200===t.status&&(e.$store.commit("logout"),e.$router.replace("/"))})}},NHnr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("7+uW"),o={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]};var a=n("VU/8")({name:"App"},o,!1,function(e){n("gsu9")},null,null).exports,s=n("/ocq"),i=n("K31e"),u=n("wUZA");r.default.use(s.a);var l=new s.a({routes:[{path:"/",name:"Login",component:i.default,hidden:!0},{path:"/home",name:"主页",component:u.default,hidden:!0,meta:{requireAuth:!0}}]}),c=n("Gir3"),d=n.n(c),m=n("IcnI"),p=(n("hsAa"),n("P9l9"));r.default.config.productionTip=!1,r.default.use(d.a),r.default.prototype.getRequest=p.b,r.default.prototype.postRequest=p.c,r.default.prototype.deleteRequest=p.a,r.default.prototype.putRequest=p.d,l.beforeEach(function(e,t,n){(console.log("路由变化:"+t.name+" -> "+e.name),"Login"===e.name)?n():""===m.a.state.token.toString()?(console.log("token 丢失 重新登录"),n({path:"/",query:{redirect:e.path}})):n()}),new r.default({el:"#app",router:l,store:m.a,components:{App:a},template:"<App/>"})},NsFC:function(e,t){},P9l9:function(e,t,n){"use strict";n.d(t,"c",function(){return m}),n.d(t,"d",function(){return p}),n.d(t,"a",function(){return f}),n.d(t,"b",function(){return h});var r=n("//Fk"),o=n.n(r),a=n("mvHQ"),s=n.n(a),i=n("aozt"),u=n.n(i),l=n("Gir3"),c=(n.n(l),n("IcnI")),d=void 0;u.a.interceptors.request.use(function(e){return console.debug("["+e.method+"]"+e.url+"->"+s()(e.params,null," ")),d=l.Loading.service({text:"请稍等",target:document.querySelector(".loadingtext")}),c.a.state.token&&(e.headers.common["x-access-token"]=c.a.state.token),e},function(e){return l.Message.error({message:"请求超时!"}),o.a.resolve(e)}),u.a.interceptors.response.use(function(e){if(console.debug("["+e.config.method+"]"+e.config.url+"->"+s()(e.data,null," ")),d.close(),!e.status||200!==e.status||"error"!==e.data.status)return e;l.Message.error({message:e.data.data})},function(e){return 504===e.response.status||404===e.response.status?l.Message.error({message:"服务器被吃了⊙﹏⊙∥"}):403===e.response.status?l.Message.error({message:"权限不足,请联系管理员!"}):l.Message.error({message:"未知错误!"}),o.a.resolve(e)}),u.a.defaults.baseURL="https://api.tanyakeji.com";var m=function(e,t){return u()({method:"post",url:""+e,data:t,transformRequest:[function(e){var t="";for(var n in e)t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n])+"&";return t}],headers:{"Content-Type":"application/x-www-form-urlencoded"}})},p=function(e,t){return u()({method:"put",url:""+e,data:t,transformRequest:[function(e){var t="";for(var n in e)t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n])+"&";return t}],headers:{"Content-Type":"application/x-www-form-urlencoded"}})},f=function(e){return u()({method:"delete",url:""+e})},h=function(e,t){return u()({method:"get",url:""+e,params:t})}},gsu9:function(e,t){},hsAa:function(e,t){},jyaM:function(e,t){},wUZA:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("P9l9"),o=function(e,t){t.state.menu.length>0||Object(r.b)("/menu/query").then(function(r){if(r&&200===r.status){var o=function e(t){var r=[];t.forEach(function(t){var o=t.menu,a=t.subMenu;a&&a instanceof Array&&(a=e(a));var s={path:o.path,name:o.name,iconUrl:o.iconUrl,permission:o.permission,children:a,component:function(e){n.e(0).then(function(){var t=[n("WQbi")("./components"+o.path)];e.apply(null,t)}.bind(this)).catch(n.oe)}};r.push(s)});return r}(r.data.data);e.addRoutes(o),t.commit("initMenu",o)}})};var a=n("M9A7"),s={mounted:function(){this.initUserInfo(),this.initMenuTree()},methods:{initUserInfo:function(){var e,t=this.$store.state.user.role;null!=t&&void 0!==t&&""!==t||(e=this.$store).state.user.name||Object(r.b)("/info").then(function(t){t&&200===t.status&&e.commit("initUserInfo",t.data.data)})},initMenuTree:function(){0===this.$store.state.menu.length&&o(this.$router,this.$store)},handleCommand:function(e){var t=this,n=this;"logout"===e&&this.$confirm("注销登录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(a.b)(t)}).catch(function(){n.$message({type:"info",message:"取消"})})}},data:function(){return{isDot:!1}},computed:{user:function(){return this.$store.state.user},routes:function(){return this.$store.state.menu},role:function(){switch(this.$store.state.user.role){case 1:return"超级管理员";case 2:return"地方管理员";case 3:return"商业渠道";case 4:return"药厂主管";case 5:return"销售代表";case 6:return"促销员"}}}},i={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-container",{staticClass:"home-container"},[n("el-header",{staticClass:"home-header"},[n("span",{staticClass:"home_title"},[e._v("谭雅科技")]),e._v(" "),n("div",{staticStyle:{display:"flex","align-items":"center","margin-right":"7px"}},[n("el-dropdown",{on:{command:e.handleCommand}},[n("span",{staticClass:"el-dropdown-link home_userinfo",staticStyle:{display:"flex","align-items":"center"}},[e._v("\n          "+e._s(e.role)+"\n          "),n("i",[(e.user.name,n("img",{staticStyle:{width:"40px",height:"40px","margin-right":"5px","margin-left":"5px","border-radius":"40px"},attrs:{src:e.user.name}}))])]),e._v(" "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",[e._v("个人中心")]),e._v(" "),n("el-dropdown-item",[e._v("设置")]),e._v(" "),n("el-dropdown-item",{attrs:{command:"logout",divided:""}},[e._v("注销")])],1)],1)],1)]),e._v(" "),n("el-container",[n("el-aside",{staticClass:"home-aside",attrs:{width:"180px"}},[n("div",{staticStyle:{display:"flex","justify-content":"flex-start",width:"180px","text-align":"left"}},[n("el-menu",{staticStyle:{background:"#ececec",width:"180px"},attrs:{"unique-opened":"",router:""}},[e._l(this.routes,function(t,r){return t.hidden?e._e():[n("el-submenu",{key:r,attrs:{index:r+""}},[n("template",{slot:"title"},[n("i",{class:t.iconUrl,staticStyle:{color:"#20a0ff",width:"14px"}}),e._v(" "),n("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(t.name))])]),e._v(" "),e._l(t.children,function(t){return n("el-menu-item",{key:t.path,staticStyle:{"padding-left":"30px","padding-right":"0px","margin-left":"0px",width:"170px","text-align":"left"},attrs:{width:"180px",index:t.path}},[e._v(e._s(t.name)+"\n                ")])})],2)]})],2)],1)]),e._v(" "),n("el-container",[n("el-main",[n("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[n("el-breadcrumb-item",{attrs:{to:{path:"/home"}}},[e._v("首页")]),e._v(" "),n("el-breadcrumb-item",{domProps:{textContent:e._s(this.$router.currentRoute.name)}})],1),e._v(" "),n("keep-alive",[this.$route.meta.keepAlive?n("router-view"):e._e()],1),e._v(" "),this.$route.meta.keepAlive?e._e():n("router-view")],1)],1)],1)],1)],1)},staticRenderFns:[]};var u=n("VU/8")(s,i,!1,function(e){n("NsFC")},null,null);t.default=u.exports}},["NHnr"]);
//# sourceMappingURL=app.e2ad173ae18a938d0d93.js.map